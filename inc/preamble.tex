%%%% Преамбула %%%
%
%\usepackage{fontspec} % XeTeX
%\usepackage{xunicode} % Unicode для XeTeX
%\usepackage{xltxtra}  % Верхние и нижние индексы
%\usepackage{pdfpages} % Вставка PDF
%
\usepackage[usenames,dvipsnames]{color}
\usepackage{geometry}           % пакет для задания полей страницы командой \geometry
\geometry{left=3cm,right=1.5cm,top=2cm,bottom=2cm}
\usepackage[utf8]{inputenc}   % кодировка текста
\usepackage{mathtext}           % позволяет использовать русские буквы в формулах
\usepackage[T2A]{fontenc}       %пакет Т2А необходим для правильного отображения кириллицы и переноса слов
%\inputencoding{cp1251}          % тоже кодировка...
\usepackage[russian]{babel}     % языковой пакет - последний язык главный
\usepackage[unicode]{hyperref}  %создаёт гиперссылки на список литературы в pdf-файле
\usepackage{amstext,amsmath,amssymb}            % пакеты для формул
\usepackage{bm}                 % boldmath - пакет для жирного шрифта
\usepackage[pdftex]{graphicx}   % пакет для включения рисунков в форматах png,pdf,jpg,mps,tif
\usepackage{titlesec}
\usepackage[title,titletoc]{appendix}

\usepackage{amsfonts}           % греческие символы и, возможно, что-то ещё
\usepackage{indentfirst}        % одинаковый отступ для первого параграфа и всего остального
\usepackage{cite}               % команда /cite{1,2,7,9} даёт ссылки
\usepackage{multirow}           % пакет для объединения строк в таблице: надо указать число строк и ширину столбца
\usepackage{array}              % нужен для создания таблиц
\linespread{1.3}                % полтора интервала. Если 1.6, то два интервала
\pagestyle{plain}               % номерует страницы

\usepackage[title,titletoc]{appendix}
\usepackage{listings} % Оформление исходного кода
\lstset{
	language=Python,
    basicstyle=\small\ttfamily, % Размер и тип шрифта
    breaklines=true, % Перенос строк
    tabsize=2, % Размер табуляции
    literate={--}{{-{}-}}2 % Корректно отображать двойной дефис
}
%
%% Шрифты, xelatex
%\defaultfontfeatures{Ligatures=TeX}
%\setmainfont{Times New Roman} % Нормоконтроллеры хотят именно его
%\newfontfamily\cyrillicfont{Times New Roman}
%%\setsansfont{Liberation Sans} % Тут я его не использую, но если пригодится
%\setmonofont{FreeMono} % Моноширинный шрифт для оформления кода
%
%% Русский язык
%\usepackage{polyglossia}
%\usepackage{amssymb,amsfonts,amsmath} % Математика
%\numberwithin{equation}{section} % Формула вида секция.номер
%
%\usepackage{enumerate} % Тонкая настройка списков
%\usepackage{indentfirst} % Красная строка после заголовка
%\usepackage{float} % Расширенное управление плавающими объектами
%\usepackage{multirow} % Сложные таблицы
%
%% Пути к каталогам с изображениями
%\usepackage{graphicx} % Вставка картинок и дополнений
%\graphicspath{{images/}{images/userguide/}{images/testing/}{images/infrastructure/}{extra/}{extra/drafts/}}
%
%% Формат подрисуночных записей
%\usepackage{chngcntr}
%\counterwithin{figure}{section}
%
%% Гиперссылки
\usepackage{hyperref}
\hypersetup{
    colorlinks, urlcolor={black}, % Все ссылки черного цвета, кликабельные
    linkcolor={black}, citecolor={black}, filecolor={black},
    pdfauthor={Дмитрий Юдаков},
    pdftitle={Исследование методов и разработка алгоритма детектирования, описания и извлечения конфигураций кисти человека}
}
%
%% Оформление библиографии и подрисуночных записей через точку
%\makeatletter
%\renewcommand*{\@biblabel}[1]{\hfill#1.}
%\renewcommand*\l@section{\@dottedtocline{1}{1em}{1em}}
%\renewcommand{\thefigure}{\thesection.\arabic{figure}} % Формат рисунка секция.номер
%\renewcommand{\thetable}{\thesection.\arabic{table}} % Формат таблицы секция.номер
%\def\redeflsection{\def\l@section{\@dottedtocline{1}{0em}{10em}}}
%\makeatother
%
%\renewcommand{\baselinestretch}{1.4} % Полуторный межстрочный интервал
%\parindent 1.27cm % Абзацный отступ
%
%\sloppy             % Избавляемся от переполнений
%\hyphenpenalty=1000 % Частота переносов
%\clubpenalty=10000  % Запрещаем разрыв страницы после первой строки абзаца
%\widowpenalty=10000 % Запрещаем разрыв страницы после последней строки абзаца
%
%% Отступы у страниц
%\usepackage{geometry}
%\geometry{left=3cm}
%\geometry{right=1cm}
%\geometry{top=2cm}
%\geometry{bottom=2cm}
%
%% Списки
\usepackage{enumitem}
\setlist[enumerate,itemize]{leftmargin=12.7mm} % Отступы в списках
%
%\makeatletter
%    \AddEnumerateCounter{\asbuk}{\@asbuk}{м)}
%\makeatother
\setlist{nolistsep} % Нет отступов между пунктами списка
%\renewcommand{\labelitemi}{--} % Маркет списка --
%\renewcommand{\labelenumi}{\asbuk{enumi})} % Список второго уровня
%\renewcommand{\labelenumii}{\arabic{enumii})} % Список третьего уровня
%
%% Содержание
%\usepackage{tocloft}
%\renewcommand{\cfttoctitlefont}{\hspace{0.38\textwidth}\MakeTextUppercase} % СОДЕРЖАНИЕ
%\renewcommand{\cftsecfont}{\hspace{0pt}}            % Имена секций в содержании не жирным шрифтом
%\renewcommand\cftsecleader{\cftdotfill{\cftdotsep}} % Точки для секций в содержании
%\renewcommand\cftsecpagefont{\mdseries}             % Номера страниц не жирные
%\setcounter{tocdepth}{3}                            % Глубина оглавления, до subsubsection
%
%%% Нумерация страниц справа сверху
%%\usepackage{fancyhdr}
%%\pagestyle{fancy}
%%\fancyhf{}
%%\fancyhead[R]{\textrm{\thepage}}
%%\fancyheadoffset{0mm}
%%\fancyfootoffset{0mm}
%%\setlength{\headheight}{17pt}
%%\renewcommand{\headrulewidth}{0pt}
%%\renewcommand{\footrulewidth}{0pt}
%%\fancypagestyle{plain}{ 
%%    \fancyhf{}
%%    \rhead{\thepage}
%%}
%
%% Формат подрисуночных надписей
\RequirePackage{caption}
\DeclareCaptionLabelSeparator{defffis}{. } % Разделитель
\captionsetup[figure]{justification=centering, labelsep=defffis, format=plain} % Подпись рисунка по центру
\captionsetup[table]{justification=centering, labelsep=defffis, format=plain, singlelinecheck=false} % Подпись таблицы слева
\addto\captionsrussian{\renewcommand{\figurename}{Рис.}} % Имя фигуры

%% Пользовательские функции


%\newcommand{\addimgapp}[2]{ % Это костыль для приложения Б
%    \begin{figure}[H]
%        \centering
%        \includegraphics[width=1\linewidth]{#1}
%        \caption*{#2}
%    \end{figure}
%}


\newcommand{\addimg}[4]{ % Добавление одного рисунка
    \begin{figure}
        \centering
        \includegraphics[width=#2\linewidth]{#1}
        \caption{#3} \label{#4}
    \end{figure}
}

\newcommand{\addimghere}[4]{ % Добавить рисунок непосредственно в это место
    \begin{figure}[H]
        \centering
        \includegraphics[width=#2\linewidth]{#1}
        \caption{#3} \label{#4}
    \end{figure}
}

\newcommand{\addtwoimghere}[4]{
	\begin{figure}[h]
		\begin{minipage}[h]{0.5\linewidth}
			\center{\includegraphics[width=0.9\linewidth]{#1} \\ а)}
		\end{minipage}
		\hfill
		\begin{minipage}[h]{0.5\linewidth}
			\center{\includegraphics[width=0.9\linewidth]{#2} \\ б)}
		\end{minipage}
		\caption{#3}
		\label{#4}
	\end{figure}
}

\newcommand{\addtwoimgherepro}[6]{
	\begin{figure}[h]
		\begin{minipage}[h]{#5\linewidth}
			\center{\includegraphics[width=1\linewidth]{#1} \\ а)}
		\end{minipage}
		\hfill
		\begin{minipage}[h]{#6\linewidth}
			\center{\includegraphics[width=1\linewidth]{#2} \\ б)}
		\end{minipage}
		\caption{#3}
		\label{#4}
	\end{figure}
}

\newcommand{\addimgsandhistshere}[6]{
	\begin{figure}[hp]
		\begin{minipage}[hp]{0.3\linewidth}
			\center{\includegraphics[width=1\linewidth]{#1}} \\a) 
		\end{minipage}
		\begin{minipage}[hp]{0.7\linewidth}
			\center{\includegraphics[width=1\linewidth]{#2}} \\б)
		\end{minipage}
		\vfill
		\begin{minipage}[hp]{0.3\linewidth}
			\center{\includegraphics[width=1\linewidth]{#3}} \\в)
		\end{minipage}
		\begin{minipage}[hp]{0.7\linewidth}
			\center{\includegraphics[width=1\linewidth]{#4}} \\г)
		\end{minipage}
		\caption{#5}
		\label{#6}
	\end{figure}
}

\newcommand{\addtwoxtwoimghere}[6]{
	\begin{figure}[hp]
		\begin{minipage}[hp]{0.5\linewidth}
			\center{\includegraphics[width=0.7\linewidth]{#1}} \\a) 
		\end{minipage}
		\begin{minipage}[hp]{0.5\linewidth}
			\center{\includegraphics[width=0.7\linewidth]{#2}} \\б)
		\end{minipage}
		\vfill
		\begin{minipage}[hp]{0.5\linewidth}
			\center{\includegraphics[width=0.7\linewidth]{#3}} \\в)
		\end{minipage}
		\begin{minipage}[hp]{0.5\linewidth}
			\center{\includegraphics[width=0.7\linewidth]{#4}} \\г)
		\end{minipage}
		\caption{#5}
		\label{#6}
	\end{figure}
}



%
%% Заголовки секций в оглавлении в верхнем регистре
%\usepackage{textcase}
%\makeatletter
%\let\oldcontentsline\contentsline
%\def\contentsline#1#2{
%    \expandafter\ifx\csname l@#1\endcsname\l@section
%        \expandafter\@firstoftwo
%    \else
%        \expandafter\@secondoftwo
%    \fi
%    {\oldcontentsline{#1}{\MakeTextUppercase{#2}}}
%    {\oldcontentsline{#1}{#2}}
%}
%\makeatother
%
%% Оформление заголовков
%\usepackage[compact,explicit]{titlesec}
%\titleformat{\section}{}{}{12.5mm}{\centering{\thesection\quad\MakeTextUppercase{#1}}\vspace{1.5em}}
%\titleformat{\subsection}[block]{\vspace{1em}}{}{12.5mm}{\thesubsection\quad#1\vspace{1em}}
%\titleformat{\subsubsection}[block]{\vspace{1em}\normalsize}{}{12.5mm}{\thesubsubsection\quad#1\vspace{1em}}
%\titleformat{\paragraph}[block]{\normalsize}{}{12.5mm}{\MakeTextUppercase{#1}}
%
%% Секции без номеров (введение, заключение...), вместо section*{}
\newcommand{\anonsection}[1]{
    \phantomsection % Корректный переход по ссылкам в содержании
    \paragraph{\LARGE{\leftline{{#1}}}\vspace{1em}}
    \addcontentsline{toc}{section}{#1}
}

%
%% Секции для приложений
%\newcommand{\appsection}[1]{
%    \phantomsection
%    \paragraph{\centerline{{#1}}}
%    \addcontentsline{toc}{section}{\uppercase{#1}}
%}
%
%% Библиография: отступы и межстрочный интервал
%\makeatletter
%\renewenvironment{thebibliography}[1]
%    {\section*{\refname}
%        \list{\@biblabel{\@arabic\c@enumiv}}
%           {\settowidth\labelwidth{\@biblabel{#1}}
%            \leftmargin\labelsep
%            \itemindent 16.7mm
%            \@openbib@code
%            \usecounter{enumiv}
%            \let\p@enumiv\@empty
%            \renewcommand\theenumiv{\@arabic\c@enumiv}
%        }
%        \setlength{\itemsep}{0pt}
%    }
%\makeatother

\usepackage{listings}
\usepackage{color}
\usepackage{minted}
\usepackage{python}
%\definecolor{dkgreen}{rgb}{0,0.6,0}
%\definecolor{gray}{rgb}{0.5,0.5,0.5}
%\definecolor{mauve}{rgb}{0.58,0,0.82}
%
\lstset{ %
language=Python,                 % выбор языка для подсветки (здесь это С)
basicstyle=\small\sffamily, % размер и начертание шрифта для подсветки кода
numbers=left,               % где поставить нумерацию строк (слева\справа)
numberstyle=\tiny,           % размер шрифта для номеров строк
stepnumber=1,                   % размер шага между двумя номерами строк
numbersep=5pt,                % как далеко отстоят номера строк от подсвечиваемого кода
backgroundcolor=\color{white}, % цвет фона подсветки - используем \usepackage{color}
showspaces=false,            % показывать или нет пробелы специальными отступами
showstringspaces=false,      % показывать или нет пробелы в строках
showtabs=false,             % показывать или нет табуляцию в строках
frame=single,              % рисовать рамку вокруг кода
tabsize=2,                 % размер табуляции по умолчанию равен 2 пробелам
captionpos=t,              % позиция заголовка вверху [t] или внизу [b] 
breaklines=true,           % автоматически переносить строки (да\нет)
breakatwhitespace=false, % переносить строки только если есть пробел
escapeinside={\%*}{*)}   % если нужно добавить комментарии в коде
}

 
\titleformat{\paragraph}[display]
    {\filcenter}
    {\MakeUppercase{\chaptertitlename} \thechapter}
    {8pt}
    {\bfseries}{}
\titlespacing*{\paragraph}{0pt}{-30pt}{8pt}
 
\newcommand{\append}[1]{  
    \clearpage
    \stepcounter{chapter}    
    \paragraph{\MakeUppercase{#1}}
    \empline
    \addcontentsline{toc}{likechapter}{\MakeUppercase{\chaptertitlename~\Asbuk{chapter}\;#1}}}

%\setcounter{page}{4} % Начало нумерации страниц